<script src="slug-web.js"></script>

<style>
  body {text-align: center}
  table {border-spacing: 15px;}
  td {vertical-align: top; width: 20%; background-color: #eee; padding: 10px; }
</style>

<h1>Federated Wiki Title Network</h1>
<p>Click a title to center the display on that page of the federation.<br>
See count of forks รท sites.</p>
<table>
  <tr>
    <th id="gdadh"> <th id="dadh"> <th id="meh"> <th id="sonh"> <th id="gsonh">
  <tr>
    <td id="gdad"> <td id="dad"> <td id="me"> <td id="son"> <td id="gson">

<script>

  var center = location.search.replace(/^\?/,'').split(/,/)
  column('me', center)
  column('son', that = outbound(center))
  column('gson', outbound(that))
  column('dad', that = inbound(center))
  column('gdad', inbound(that))

  function outbound (titles) {
    function links (list, slug) {return list.concat(slugs[slug].links)}
    function uniq (item, pos, self) {return self.indexOf(item) == pos}
    return titles.reduce(links,[]).filter(uniq)
  }

  function inlinks(slug) {
    function cites (key) {return slugs[key].links.indexOf(slug) >= 0}
    return Object.keys(slugs).filter(cites)
  }

  function inbound (titles) {
    function from (slug) {return Object.keys(slugs).filter(cites)}
    function links (list, slug) {return list.concat(inlinks(slug))}
    function uniq (item, pos, self) {return self.indexOf(item) == pos}
    return titles.reduce(links,[]).filter(uniq)
  }

  function column (id, list) {
    function forks (sum, slug) {return sum + slugs[slug].forks}
    var html = list.reduce(forks,0) + ' รท ' + list.length
    eval(id + 'h.innerHTML = html')
    function li (text) {return '<li>' + text.replace(/-/g,' ')}
    var html = list.map(li).join('')
    eval(id + '.innerHTML = html')
  }

  window.onclick = function (e) {
    if (e.target.localName == 'li') {
      console.log(e.target.innerHTML.replace(/ /g,'-'))
      location = '/title.html?' + e.target.innerHTML.replace(/ /g,'-')
    }
  }

</script>
